<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns="http://www.w3.org/2010/09/qt-fots-catalog" name="fn-xml-to-json" covers="fn-xml-to-json">
  <description>xml-to-json() function introduced in XPath 3.1</description>
  <link type="spec" document="http://www.w3.org/TR/xpath-functions-31/"
    idref="func-json-to-xml"/>

   <dependency type="spec" value="XP31+ XQ31+"/>

   <test-case name="xml-to-json-001">
      <description>simple "null" content, not indented</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('null',map{'liberal':true()}))</test>
      <result>
            <assert-eq>"null"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-002">
      <description>simple "null" content, not indented</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('null',map{'liberal':true()}))</test>
      <result>
            <assert-eq>"null"</assert-eq>
      </result>
   </test-case>

      <test-case name="xml-to-json-003">
      <description>simple "null" content, not indented</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('null',map{'liberal':true()}))</test>
      <result>
            <assert-eq>"null"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-004">
      <description>simple "true" content, not indented</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('true'))</test>
      <result>
            <assert-eq>"true"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-005">
      <description>simple "false" content</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('false'))</test>
      <result>
            <assert-eq>"false"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-006">
      <description>simple "number" content</description>
       <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('93.7'))</test>
      <result>
            <assert-eq>"93.7"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-007">
      <description>simple variable content</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <dependency type="spec" value="XQ31+"/>
       <test>
           declare variable $in := '"London"';
          xml-to-json(json-to-xml($in))</test>
      <result>
            <assert-eq>'"London"'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-008">
      <description>simple variable with empty string</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <dependency type="spec" value="XQ31+"/>
      <test>
           declare variable $in := '""';
          xml-to-json(json-to-xml($in))</test>
      <result>
            <assert-eq>'""'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-009">
      <description>empty array</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('[]'))</test>
      <result>
            <assert-eq>'[]'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-010">
      <description>singleton array</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('[34]'))</test>
      <result>
            <assert-eq>'[34]'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-011">
      <description>two-member array</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('[true, false]'))</test>
      <result>
            <assert-eq>'[true,false]'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-012">
      <description>simple variable with empty string</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('["A", "B", "C", "D", "E"]'))</test>
      <result>
            <assert-eq>'["A","B","C","D","E"]'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-013">
      <description>empty map</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <test>xml-to-json(json-to-xml('{}'))</test>
      <result>
            <assert-eq>'{}'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-014">
      <description>1 entry map</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
       <test>xml-to-json(json-to-xml('{"A":true}'))</test>
      <result>
            <assert-eq>'{"A":true}'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-015">
      <description>five entry map</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
       <test>xml-to-json(json-to-xml('{"A":1, "B":2, "C":3, "D":4, "E":5}'))</test>
      <result>
            <assert-eq>'{"A":1,"B":2,"C":3,"D":4,"E":5}'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-016">
      <description>complex map</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
       <test>xml-to-json(json-to-xml('{"A":[1,2], "B":[true,false], "C":["Paris","London","Berlin"], "D":[1, true, "on"], "E":[null, null]}'))</test>
      <result>
            <assert-eq>'{"A":[1,2],"B":[true,false],"C":["Paris","London","Berlin"],"D":[1,true,"on"],"E":[null,null]}'</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-017">
      <description>1 entry map</description>
      <created by="Michael Kay" on="2014-07-19"/>
      <modified by="O'Neil Delpratt" on="2015-02-24" change="This test case was ported from the XSLT30 test suite" />
      <modified by="Debbie Lockett" on="2015-08-07" change="Change result (see bug #28995)"/>
       <test>xml-to-json(json-to-xml('"\\\/\"\r\t\n\u0020"'))</test>
      <result>
            <assert-eq>'"\\/"\r\t\n "'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-021">
      <description>simple "null" content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<null xmlns="http://www.w3.org/2005/xpath-functions"/>)
       ]]></test>
      <result>
            <assert-eq>"null"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-022">
      <description>simple true content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<boolean xmlns="http://www.w3.org/2005/xpath-functions">true</boolean>)
       ]]></test>
      <result>
            <assert-eq>"true"</assert-eq>
      </result>
   </test-case>

   <test-case name="xml-to-json-023">
      <description>simple numeric content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<number xmlns="http://www.w3.org/2005/xpath-functions">23</number>)
       ]]></test>
      <result>
            <assert-eq>"23"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-024">
      <description>simple string content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">banana</string>)
       ]]></test>
      <result>
            <assert-eq>'"banana"'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-025">
      <description>boolean with whitespace (bug 28180)</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<boolean xmlns="http://www.w3.org/2005/xpath-functions"> false </boolean>)
       ]]></test>
      <result>
            <assert-eq>"false"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-026">
      <description>number with leading zeroes and whitespace (bug 28180)</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<number xmlns="http://www.w3.org/2005/xpath-functions"> +005 </number>)
       ]]></test>
      <result>
            <assert-eq>"5"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-027">
      <description>whitespace string (bug 28180)</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">   </string>)
       ]]></test>
      <result>
            <assert-eq>'"   "'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-028">
      <description>array with comments and whitespace</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<array xmlns="http://www.w3.org/2005/xpath-functions"> <null/> <!--comma--> <null/>   </array>)
       ]]></test>
      <result>
            <assert-eq>"[null,null]"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-029">
      <description>map with comments and whitespace</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"> <null key="a"/> <!--comma--> <null key="b"/>   </map>)
       ]]></test>
      <result>
            <assert-eq>'{"a":null,"b":null}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-030">
      <description>Document node wrapper</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(document{<array xmlns="http://www.w3.org/2005/xpath-functions"><null/><null/></array>})
       ]]></test>
      <result>
            <assert-eq>"[null,null]"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-031">
      <description>Use a namespace prefix</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(document{<jj:array xmlns:jj="http://www.w3.org/2005/xpath-functions"><jj:null/><jj:null/></jj:array>})
       ]]></test>
      <result>
            <assert-eq>"[null,null]"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-032">
      <description>Wrong namespace</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(document{<jj:array xmlns:jj="http://www.w3.org/2005/xpath-functions/not-json"><jj:null/><jj:null/></jj:array>})
       ]]></test>
      <result>
           <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-033">
      <description>Invalid XML: contains disallowed attributes</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"> <null key="a" yek="z"/> <null key="b"/>   </map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-034">
      <description>Invalid XML: contains disallowed elements</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"> <null key="a"/> <null key="b"/> <yek key="c"/>  </map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-035">
      <description>Invalid XML: contains missing attribute</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"><null/><null/></map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-036">
      <description>Invalid XML: contains duplicate keys</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"><null key="a"/><null key="a"/></map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-037">
      <description>String split by a comment</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">ban<!--c-->ana</string>)
       ]]></test>
      <result>
            <assert-eq>'"banana"'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-038">
      <description>Number split by a comment</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<number xmlns="http://www.w3.org/2005/xpath-functions">2<!--c-->7</number>)
       ]]></test>
      <result>
            <assert-eq>'27'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-039">
      <description>Boolean split by a comment</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<boolean xmlns="http://www.w3.org/2005/xpath-functions">tr<!--c-->ue</boolean>)
       ]]></test>
      <result>
            <assert-eq>'true'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-040">
      <description>Invalid child of string</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">ok<null/></string>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-041">
      <description>Invalid child of number</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<number xmlns="http://www.w3.org/2005/xpath-functions">17<string>qq</string></number>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-042">
      <description>Invalid child of boolean</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        declare boundary-space preserve;
        xml-to-json(<boolean xmlns="http://www.w3.org/2005/xpath-functions">true<string>qq</string></boolean>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-043">
      <description>Invalid child of null</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<null xmlns="http://www.w3.org/2005/xpath-functions"><null/></null>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-044">
      <description>Invalid child of null</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<null xmlns="http://www.w3.org/2005/xpath-functions"><null/></null>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-045">
      <description>Effect of xsi:type (bug 28181)</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Michael Kay" on="2015-07-13" change="By the decision on 28181, this is no longer an error"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<number xsi:type="xs:short" xmlns="http://www.w3.org/2005/xpath-functions" 
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
            xmlns:xs="http://www.w3.org/2001/XMLSchema">231</number>)
       ]]></test>
      <result>
            <assert-eq>"231"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-046">
      <description>Validated content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <dependency type="feature" value="schemaImport"/>
      <test><![CDATA[
        import schema default element namespace "http://www.w3.org/2005/xpath-functions";
        xml-to-json(validate strict {<number>-23.7</number>})
       ]]></test>
      <result>
            <assert-eq>"-23.7"</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-047">
      <description>Validated content. Validation fails because xsi:type isn't derived from j:numberType</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <dependency type="feature" value="schemaImport"/>
      <test><![CDATA[
        import schema default element namespace "http://www.w3.org/2005/xpath-functions";
        xml-to-json(validate strict{<number xsi:type="xs:int" 
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns:xs="http://www.w3.org/2001/XMLSchema">-23</number>})
       ]]></test>
      <result>
            <error code="XQDY0027"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-048">
      <description>Invalid content</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <dependency type="feature" value="schemaImport"/>
      <test><![CDATA[
        import schema default element namespace "http://www.w3.org/2005/xpath-functions";
        xml-to-json(validate strict{<number xsi:type="xs:int" 
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xmlns:xs="http://www.w3.org/2001/XMLSchema">-23.7</number>})
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-049">
      <description>String that needs escaping</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">abc&#xa;def</string>)
       ]]></test>
      <result>
            <assert-eq>'"abc\ndef"'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-050">
      <description>String that needs escaping</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <dependency type="xml-version" value="1.1"/>
      <test><![CDATA[
        xml-to-json(<string xmlns="http://www.w3.org/2005/xpath-functions">abc&#x7;def</string>)
       ]]></test>
      <result>
            <assert-eq>'"abc\u0007def"'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-051">
      <description>Key that needs escaping</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"><string key="&#x9;">tab</string></map>)
       ]]></test>
      <result>
            <assert-eq>'{"\t":"tab"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-052">
      <description>Key marked as escaped</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><string escaped-key="true" key="\t">tab</string></map>)
       ]]></test>
      <result>
            <assert-eq>'{"\t":"tab"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-053">
      <description>Key marked as not escaped</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><string escaped-key="0" key="\t">tab</string></map>)
       ]]></test>
      <result>
            <assert-eq>'{"\\t":"tab"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-054">
      <description>String marked as escaped</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions">
            <string escaped="1" key="t1">\t</string>
            <string escaped="0" key="t2">\t</string>
            <string escaped="1" key="t3">&#x9;</string>
            <string escaped="0" key="t4">&#x9;</string>
        </map>)
       ]]></test>
      <result>
            <assert-eq>'{"t1":"\t","t2":"\\t","t3":"\t","t4":"\t"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-055">
      <description>String marked as not escaped</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><string escaped="false" key="tab">\t</string></map>)
       ]]></test>
      <result>
            <assert-eq>'{"tab":"\\t"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-056">
      <description>Indent</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        let $result := xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><number key="a">1</number><number key="b">2</number></map>, map{'indent':true()})
        return translate(normalize-space($result), ' ', '')
       ]]></test>
      <result>
            <assert-eq>'{"a":1,"b":2}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-057">
      <description>Indent</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        let $result := xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><number key="a">1</number><number key="b">2</number></map>, map{'indent':true()})
        return normalize-space($result) eq $result
       ]]></test>
      <result>
            <!-- technically indent=true could have a null implementation but we assume it does something -->
            <assert-false/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-058">
      <description>Indent=false</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        let $result := xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><number key="a">1</number><number key="b">2</number></map>, map{'indent':false()})
        return normalize-space($result) eq $result
       ]]></test>
      <result>
            <assert-true/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-059">
      <description>Indent=rubbish</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29022"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        let $result := xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><number key="a">1</number><number key="b">2</number></map>, map{'indent':()})
        return normalize-space($result) eq $result
       ]]></test>
      <result>
         <error code="XPTY0004"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-060">
      <description>Unknown options are ignored</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        let $result := xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><number key="a">1</number><number key="b">2</number></map>, map{'indent':false(), 'outdent':true()})
        return normalize-space($result) eq $result
       ]]></test>
      <result>
            <assert-true/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-061">
      <description>Validated content with maps and arrays</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <dependency type="feature" value="schemaImport"/>
      <test><![CDATA[
        import schema default element namespace "http://www.w3.org/2005/xpath-functions";
        xml-to-json(validate strict {json-to-xml('{"a":2, "b\\":[null, true, false, "xyz\t"]}')})
       ]]></test>
      <result>
            <assert-eq>'{"a":2,"b\\":[null,true,false,"xyz\t"]}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-062">
      <description>Invalid value of escaped-key attribute</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><string escaped-key="bonkers" key="\t">tab</string></map>)
       ]]></test>
      <result>
         <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-063">
      <description>Invalid value of escaped attribute</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        ><string escaped="potty" key="\t">tab</string></map>)
       ]]></test>
      <result>
         <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-064">
      <description>Invalid position of escaped-key attribute</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
        escaped-key="0"><string key="\t">tab</string></map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-065">
      <description>Invalid position of escaped attribute</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
         escaped="0"><string key="\t">tab</string></map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-066">
      <description>Empty sequence</description>
      <created by="Michael Kay" on="2015-03-10"/>
      <test>xml-to-json(())</test>
      <result>
          <assert-empty/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-067">
      <description>Empty sequence</description>
      <created by="Michael Kay" on="2015-03-10"/>
      <test>xml-to-json((), map{})</test>
      <result>
          <assert-empty/>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-068">
      <description>Attributes in other namespaces are OK</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<map xmlns="http://www.w3.org/2005/xpath-functions"
         xml:base="http://www.w3.org"><string key="t">tab</string></map>)
       ]]></test>
      <result>
            <assert-eq>'{"t":"tab"}'</assert-eq>
      </result>
   </test-case>
   
   <test-case name="xml-to-json-069">
      <description>Attributes in JSON namespace are not OK</description>
      <created by="Michael Kay" on="2015-03-09"/>
      <modified by="Michael Kay" on="2015-06-23" change="Namespace change for bug 28174"/>
      <modified by="Debbie Lockett" on="2015-08-04" change="Error code change for bug 29021"/>
      <dependency type="spec" value="XQ31"/>
      <test><![CDATA[
        xml-to-json(<j:map xmlns:j="http://www.w3.org/2005/xpath-functions"
         j:base="http://www.w3.org"><j:string key="t">tab</j:string></j:map>)
       ]]></test>
      <result>
            <error code="FOJS0006"/>
      </result>
   </test-case>





</test-set>