<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns="http://www.w3.org/2010/09/qt-fots-catalog" name="fn-json-to-xml" covers="fn-json-to-xml">
  <description>xml-to-json() function introduced in XPath 3.1</description>
  <link type="spec" document="http://www.w3.org/TR/xpath-functions-31/"
    idref="func-json-to-xml"/>

   <dependency type="spec" value="XP31+ XQ31+"/>

  <environment name="json-files">
      <resource file="json/data001.json"
                media-type="text/plain"
                encoding="utf-8"
                uri="http://www.w3.org/qt3/json/data001-json">
         <description>UTF-8 encoded plain text.</description>
         <created by="O'Neil Delpratt" on="2015-02-23"/>
      </resource>
      <resource file="json/escapeText.json"
                media-type="text/plain"
                encoding="utf-8"
                uri="http://www.w3.org/qt3/json/escapeText-json">
         <description>UTF-8 encoded plain text.</description>
         <created by="O'Neil Delpratt" on="2015-02-23"/>
      </resource>
      <resource file="json/data005.json"
                media-type="text/plain"
                encoding="utf-8"
                uri="http://www.w3.org/qt3/json/data005-json">
         <description>UTF-8 encoded plain text.</description>
         <created by="O'Neil Delpratt" on="2015-02-23"/>
      </resource>
      <namespace prefix="j" uri="http://www.w3.org/2013/XSL/json"/>
     </environment>

   <environment name="json-ns">
        <namespace prefix="j" uri="http://www.w3.org/2013/XSL/json"/>
    </environment>


   <test-case name="json-to-xml-001">
      <description>Empty object as document-node</description>
       <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('{}')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>document-node()</assert-type>
                <assert-xml><![CDATA[<j:map/>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-002">
      <description>Empty array as document-node</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>document-node()</assert-type>
                <assert-xml><![CDATA[<j:array/>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-003">
      <description>Array Number</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[1]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(j:array)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>$result/*[1] instance of element(j:number,xs:untyped)</assert>
                <assert>xs:double($result/*[1]) eq 1</assert>
                <assert-xml><![CDATA[<j:array><j:number>1</j:number></j:array>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-004">
      <description>Array String</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[&#34;a&#34;]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(*)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>$result/*[1] instance of element(j:string,xs:untyped)</assert>
                <assert>xs:string($result/*[1]) eq "a"</assert>
                <assert-xml><![CDATA[<j:array><j:string>a</j:string></j:array>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-005">
      <description>Array true</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[true]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(*)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>$result/*[1] instance of element(j:boolean,xs:untyped)</assert>
                <assert>xs:boolean($result/*[1]) eq true()</assert>
                <assert-xml><![CDATA[<j:array><j:boolean>true</j:boolean></j:array>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-006">
      <description>Array false</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[false]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(*)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>$result/*[1] instance of element(j:boolean,xs:untyped)</assert>
                <assert>xs:boolean($result/*[1]) eq false()</assert>
                <assert-xml><![CDATA[<j:array><j:boolean>false</j:boolean></j:array>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-007">
      <description>Array null</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns" />
      <test>fn:json-to-xml('[null]')</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(*)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>$result/*[1] instance of element(j:null,xs:untyped)</assert>
                <assert>empty($result/*[1]/(*|text()))</assert>
                <assert-xml><![CDATA[<j:array><j:null/></j:array>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-008">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-files"/>
      <test>fn:json-to-xml(unparsed-text('http://www.w3.org/qt3/json/data001-json'))</test>
      <result>
            <all-of>
                <assert-count>1</assert-count>
                <assert-type>element(*)</assert-type>
                <assert>count($result/*) eq 1</assert>
                <assert>/j:map/j:map[@key='glossary']/j:string[@key='title']</assert>
                <assert>/j:map/j:map[@key='glossary']/j:map[@key='GlossDiv']</assert>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-009">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-files"/>
      <test>fn:json-to-xml(unparsed-text('http://www.w3.org/qt3/json/data005-json'))</test>
      <result>
            <all-of>
                <assert>/j:map/j:map[@key='menu']/j:string[@key='header'][.='SVG Viewer']</assert>
                <assert>/j:map/j:map[@key='menu']/j:array[@key='items']/j:map[not(@*)]/j:string[@key='id'][.='Open']</assert>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-010">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-files"/>
      <test>fn:json-to-xml(unparsed-text('http://www.w3.org/qt3/json/escapeText-json'))</test>
      <result>
            <assert-xml><![CDATA[<j:map><j:string key="key">Data with " within it</j:string></j:map>]]></assert-xml>
      </result>
   </test-case>


   <test-case name="json-to-xml-011">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-files"/>
      <test>fn:json-to-xml(unparsed-text('http://www.w3.org/qt3/json/escapeText-json'))//j:string</test>
      <result>
            <assert-xml><![CDATA[<j:string key="key">Data with " within it</j:string>]]></assert-xml>
      </result>
   </test-case>

   <test-case name="json-to-xml-012">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-files"/>
      <test>
         fn:json-to-xml(unparsed-text('http://www.w3.org/qt3/json/escapeText-json'), map{'unescape':false()})//j:string
      </test>
      <result>
         <all-of>
                <assert-type>element(Q{http://www.w3.org/2013/XSL/json}string)</assert-type>
                <assert-xml><![CDATA[<j:string key="key" escaped="true">Data with \" within it</j:string>]]></assert-xml>
            </all-of>
      </result>
   </test-case>


   <test-case name="json-to-xml-013">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml('[&#34;Data with \&#34; within it&#34;]')//j:string
      </test>
      <result>
         <all-of>
                <assert-type>element(Q{http://www.w3.org/2013/XSL/json}string)</assert-type>
                <assert-xml><![CDATA[<j:string>Data with " within it</j:string>]]></assert-xml>
            </all-of>
      </result>
   </test-case>


   <test-case name="json-to-xml-014">
      <description>Larger 2</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml('{&#34;Key \&#34; with quote&#34;:&#34;Data with \&#34; within it&#34;}')//j:string
      </test>
      <result>
         <all-of>
                <assert-type>element(Q{http://www.w3.org/2013/XSL/json}string)</assert-type>
                <assert-xml><![CDATA[<j:string key="Key &#34; with quote">Data with " within it</j:string>]]></assert-xml>
            </all-of>
      </result>
   </test-case>

   <test-case name="json-to-xml-error-001">
      <description>Empty string</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml('')
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

   <test-case name="json-to-xml-error-002">
      <description>Unknown token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({error})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

   <test-case name="json-to-xml-error-003">
      <description>Unknown token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({terriblyWrong})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

   <test-case name="json-to-xml-error-004">
      <description>Extra token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({}"extra token")
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

   <test-case name="json-to-xml-error-005">
      <description>Extra token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({1:1})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

   <test-case name="json-to-xml-error-006">
      <description>Extra token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({true:1})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>


   <test-case name="json-to-xml-error-007">
      <description>Extra token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({"key" 1})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-008">
      <description>Extra token</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({"key" :1 2})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

  <test-case name="json-to-xml-error-009">
      <description>Leading + on the number</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml([+1])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-010">
      <description>Redundant leading 0 on number</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml([01])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-011">
      <description>Hex number</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml([1234A])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

  <test-case name="json-to-xml-error-012">
      <description>Trailing backslash</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["123\"])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

  <test-case name="json-to-xml-error-013">
      <description>short unicode</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["123\u234"])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-014">
      <description>Trailing comma</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({"key":123,})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-015">
      <description>Trailing comma liberal spec</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml({"key":123 ,}, map{'liberal':true()})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-016">
      <description>Trailing comma</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["key":123,])
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-017">
      <description>Trailing comma liberal spec</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["key":123 ,], map{'liberal':true()})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-018">
      <description>Trailing comma liberal spec</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'liberal':()})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>


    <test-case name="json-to-xml-error-019">
      <description>Trailing comma liberal spec</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'liberal':'something'})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>


    <test-case name="json-to-xml-error-020">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'validate':()})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-021">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'validate':(true(),true())})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-022">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'validate':'EMCA-262'})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-023">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'unescape':()})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-024">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'unescape':(true(),true())})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-025">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'unescape':'EMCA-262'})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

    <test-case name="json-to-xml-error-026">
      <description>Validate option error</description>
      <created by="John Lumley" on="2013-10-01"/>
      <modified by="O'Neil Delpratt" on="2015-02-11" change="This test case was ported from the XSLT30 test suite" />
      <environment ref="json-ns"/>
      <test>
         fn:json-to-xml(["String"], map{'fallback':'dummy'})
      </test>
        <result>
            <error code="XTDE3240"/>
        </result>
   </test-case>

</test-set>