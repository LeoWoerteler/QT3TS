<?xml version="1.0" encoding="us-ascii"?>
<test-set xmlns="http://www.w3.org/2010/09/qt-fots-catalog" name="fn-function-lookup">
   <description>Tests for the fn:function-lookup() function introduced in XPath 3.0</description>
   <link type="spec" document="http://www.w3.org/TR/xpath-functions-30/"
         idref="func-function-lookup"/>
   <dependency type="spec" value="XP30+ XQ30+"/>
   <test-case name="function-lookup-001">
      <description>Applied to a built-in function</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "abs"), 1)(-3)</test>
      <result>
         <assert-eq>3</assert-eq>
      </result>
   </test-case>
   <test-case name="function-lookup-002">
      <description>Applied to a built-in function with variable arity</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "concat"), 3)("a", "b", "c")</test>
      <result>
         <assert-string-value>abc</assert-string-value>
      </result>
   </test-case>
   <test-case name="function-lookup-003">
      <description>Applied to a built-in function with zero arity</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions/math", "pi"), 0)() idiv 1</test>
      <result>
         <assert-eq>3</assert-eq>
      </result>
   </test-case>
   <test-case name="function-lookup-004">
      <description>Applied to a constructor function</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2001/XMLSchema", "time"), 1)("12:30:00Z")</test>
      <result>
         <assert-eq>xs:time("12:30:00Z")</assert-eq>
      </result>
   </test-case>
   <test-case name="function-lookup-005">
      <description>Applied to a user-defined function</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        xquery version "3.0";
      	declare function local:square($i as xs:integer) as xs:integer { $i*$i };
        function-lookup(QName("http://www.w3.org/2005/xquery-local-functions", "square"), 1)(13)
      ]]></test>
      <result>
         <assert-eq>169</assert-eq>
      </result>
   </test-case>
   <test-case name="function-lookup-006">
      <description>Applied to a private user-defined function in the same module</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        xquery version "3.0";
      	declare %private function local:square($i as xs:integer) as xs:integer { $i*$i };
        function-lookup(QName("http://www.w3.org/2005/xquery-local-functions", "square"), 1)(13)
      ]]></test>
      <result>
         <assert-eq>169</assert-eq>
      </result>
   </test-case>
   <test-case name="function-lookup-007">
      <description>Applied to a non-existent function</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test><![CDATA[
        function-lookup(QName("http://www.w3.org/2005/xquery-local-functions", "cube"), 1)
      ]]></test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   <test-case name="function-lookup-008">
      <description>Applied to a non-existent function (no namespace URI)</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test><![CDATA[
        function-lookup(QName("", "round"), 2)
      ]]></test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   <test-case name="function-lookup-009">
      <description>Get the name and arity of the result</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test><![CDATA[
        function-lookup(QName("http://www.w3.org/2005/xpath-functions", "round"), 2) ! 
                   (function-name(.) ! (namespace-uri-from-QName(.), local-name-from-QName(.)), function-arity(.))
      ]]></test>
      <result>
         <assert-string-value>http://www.w3.org/2005/xpath-functions round 2</assert-string-value>
      </result>
   </test-case>
   <test-case name="function-lookup-010">
      <description>Call the function with the wrong number of arguments</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        xquery version "3.0";
      	declare %private function local:square($i as xs:integer) as xs:integer { $i*$i };
        function-lookup(QName("http://www.w3.org/2005/xquery-local-functions", "square"), 1)(13, 12)
      ]]></test>
      <result>
         <error code="XPTY0004"/>
      </result>
   </test-case>
   <test-case name="function-lookup-011">
      <description>Call the function with the wrong type of argument</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        xquery version "3.0";
      	declare %private function local:square($i as xs:integer) as xs:integer { $i*$i };
        function-lookup(QName("http://www.w3.org/2005/xquery-local-functions", "square"), 1)("banana")
      ]]></test>
      <result>
         <error code="XPTY0004"/>
      </result>
   </test-case>
   <test-case name="function-lookup-012">
      <description>Curry the resulting function</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "round"), 2)(?, 3)(1.2345678)</test>
      <result>
         <assert-string-value>1.235</assert-string-value>
      </result>
   </test-case>
   <test-case name="function-lookup-013">
      <description>Function lookup creating a circular dependency (see bug 15791 - provisional outcome)</description>
      <created by="Tim Mills" on="2012-01-30"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        declare variable $n external := xs:QName('local:return-v');
        declare variable $v := function-lookup($n, 0)();
        declare function local:return-v() {$v + 1};
        $v
      ]]></test>
      <result>
         <error code="XQST0054"/>
      </result>
   </test-case>
   <test-case name="function-lookup-014">
       <description>Function lookup accessing an EXSLT extension function, with two possible results</description>
      <created by="Michael Kay" on="2012-02-28"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        let $f := function-lookup(QName("http://exslt.org/dates-and-times", "month-abbreviation"), 1)
        return if (exists($f)) then $f("2012-02-28") else "not-available"
      ]]></test>
      <result>
         <any-of>
           <assert-string-value>not-available</assert-string-value>
           <assert-string-value>Feb</assert-string-value>
         </any-of>  
      </result>
   </test-case>
   <test-case name="function-lookup-015">
       <description>Function lookup accessing an eXist extension function, with two possible results</description>
      <created by="Michael Kay" on="2012-02-28"/>
      <dependency type="spec" value="XQ30+"/>
      <test><![CDATA[
        let $f := function-lookup(QName("http://exist-db.org/xquery/datetime", "days-in-month"), 1)
        return if (exists($f)) then $f(xs:date("2012-02-28")) else "not-available"
      ]]></test>
      <result>
         <any-of>
           <assert-string-value>not-available</assert-string-value>
           <assert-string-value>29</assert-string-value>
         </any-of>  
      </result>
   </test-case>
   <test-case name="function-lookup-016">
      <description>Attempt to access the position() function, which fails because it is context sensitive</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "position"), 0)</test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   <test-case name="function-lookup-017">
      <description>Attempt to access the last() function, which fails because it is context sensitive</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "position"), 0)</test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   <test-case name="function-lookup-018">
      <description>Attempt to access the xs:QName() constructor function, which fails because it is context sensitive</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2001/XMLSchema", "QName"), 1)</test>
      <result>
         <assert-empty/>
      </result>
   </test-case>
   <test-case name="function-lookup-019">
      <description>Attempt to access the current-date() function, which fails because it is context sensitive</description>
      <created by="Michael Kay" on="2011-10-27"/>
      <test>function-lookup(QName("http://www.w3.org/2005/xpath-functions", "current-date"), 0)</test>
      <result>
         <assert-empty/>
      </result>
   </test-case>

</test-set>